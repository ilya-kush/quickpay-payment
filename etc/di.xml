<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 *  di
 *
 * @copyright Copyright Â© 2021 https://headwayit.com/ HeadWayIt. All rights reserved.
 * @author    Ilya Kushnir ilya.kush@gmail.com
 */
-->

<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">

    <type name="Magento\Sales\Model\Order\StateResolver">
        <plugin sortOrder="9999" name="resolver_payment_review" type="HW\QuickPay\Plugin\Sales\Model\Order\StateResolver"/>
    </type>

    <!-- *
     Credit card method (general method)
     *
     *-->
    <!-- Configuration readers -->
    <virtualType name="QuickPayCreditCardGeneralConfig" type="HW\QuickPay\Gateway\Config\General">
        <arguments>
            <argument name="methodCode" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE</argument>
        </arguments>
    </virtualType>
    <!-- End Configuration readers -->

    <!-- Logger, initialized with QuickPayCreditCardGeneralConfig -->
    <virtualType name="QuickPayLogger" type="Magento\Payment\Model\Method\Logger">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayCreditCardGeneralConfig</argument>
        </arguments>
    </virtualType>

    <!-- Start Payment Method Facade configuration -->
    <virtualType name="QuickPayCreditCardFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">QuickPayCreditCardBlockInfo</argument>
            <argument name="validatorPool" xsi:type="object">QuickPayCreditCardValidatorPool</argument>
            <argument name="valueHandlerPool" xsi:type="object">QuickPayCreditCardValueHandlerPool</argument>
            <argument name="commandPool" xsi:type="object">QuickPayCreditCardCommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="QuickPayCreditCardBlockInfo" type="HW\QuickPay\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayCreditCardGeneralConfig</argument>
        </arguments>
    </virtualType>

    <!-- Validators infrastructure -->
    <virtualType name="QuickPayCreditCardValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">QuickPayCreditCardCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayCreditCardCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayCreditCardGeneralConfig</argument>
        </arguments>
    </virtualType>
    <!-- Value handlers infrastructure -->
    <virtualType name="QuickPayCreditCardValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">QuickPayCreditCardConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayCreditCardConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">QuickPayCreditCardGeneralConfig</argument>
        </arguments>
    </virtualType>
    <!-- End Payment Method Facade configuration -->

    <!-- *
     MobilePay Method
     *
     *-->
    <!-- Start MobilePay Method Facade configuration -->
    <virtualType name="QuickPayMobilePayFacade" type="QuickPayCreditCardFacade">
        <arguments>
            <argument name="code" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_MOBILEPAY</argument>
            <argument name="infoBlockType" xsi:type="string">QuickPayMobilePayBlockInfo</argument>
            <argument name="validatorPool" xsi:type="object">QuickPayMobilePayValidatorPool</argument>
            <argument name="valueHandlerPool" xsi:type="object">QuickPayMobilePayValueHandlerPool</argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="QuickPayMobilePayConfig" type="HW\QuickPay\Gateway\Config\General">
        <arguments>
            <argument name="methodCode" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_MOBILEPAY</argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayMobilePayBlockInfo" type="HW\QuickPay\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayMobilePayConfig</argument>
        </arguments>
    </virtualType>
    <!-- Validators infrastructure -->
    <virtualType name="QuickPayMobilePayValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">QuickPayMobilePayCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayMobilePayCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayMobilePayConfig</argument>
        </arguments>
    </virtualType>
    <!-- Value handlers infrastructure -->
    <virtualType name="QuickPayMobilePayValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">QuickPayMobilePayConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayMobilePayConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">QuickPayMobilePayConfig</argument>
        </arguments>
    </virtualType>
    <!-- End MobilePay Method Facade configuration -->

    <!-- Start Klarna Method Facade configuration -->
    <virtualType name="QuickPayKlarnaFacade" type="QuickPayCreditCardFacade">
        <arguments>
            <argument name="code" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_KLARNA</argument>
            <argument name="infoBlockType" xsi:type="string">QuickPayKlarnaBlockInfo</argument>
            <argument name="validatorPool" xsi:type="object">QuickPayKlarnaValidatorPool</argument>
            <argument name="valueHandlerPool" xsi:type="object">QuickPayKlarnaValueHandlerPool</argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="QuickPayKlarnaConfig" type="HW\QuickPay\Gateway\Config\General">
        <arguments>
            <argument name="methodCode" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_KLARNA</argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayKlarnaBlockInfo" type="HW\QuickPay\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayKlarnaConfig</argument>
        </arguments>
    </virtualType>
    <!-- Validators infrastructure -->
    <virtualType name="QuickPayKlarnaValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">QuickPayKlarnaCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayKlarnaCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayKlarnaConfig</argument>
        </arguments>
    </virtualType>
    <!-- Value handlers infrastructure -->
    <virtualType name="QuickPayKlarnaValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">QuickPayKlarnaConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayKlarnaConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">QuickPayKlarnaConfig</argument>
        </arguments>
    </virtualType>
    <!-- End Klarna Method Facade configuration -->

    <!-- Start Swish Method Facade configuration -->
    <virtualType name="QuickPaySwishFacade" type="QuickPayCreditCardFacade">
        <arguments>
            <argument name="code" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_SWISH</argument>
            <argument name="infoBlockType" xsi:type="string">QuickPaySwishBlockInfo</argument>
            <argument name="validatorPool" xsi:type="object">QuickPaySwishValidatorPool</argument>
            <argument name="valueHandlerPool" xsi:type="object">QuickPaySwishValueHandlerPool</argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="QuickPaySwishConfig" type="HW\QuickPay\Gateway\Config\General">
        <arguments>
            <argument name="methodCode" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_SWISH</argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPaySwishBlockInfo" type="HW\QuickPay\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">QuickPaySwishConfig</argument>
        </arguments>
    </virtualType>
    <!-- Validators infrastructure -->
    <virtualType name="QuickPaySwishValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">QuickPaySwishCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPaySwishCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">QuickPaySwishConfig</argument>
        </arguments>
    </virtualType>
    <!-- Value handlers infrastructure -->
    <virtualType name="QuickPaySwishValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">QuickPaySwishConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPaySwishConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">QuickPaySwishConfig</argument>
        </arguments>
    </virtualType>
    <!-- End Swish Method Facade configuration -->

    <!-- Start Anyday Method Facade configuration -->
    <virtualType name="QuickPayAnydayFacade" type="QuickPayCreditCardFacade">
        <arguments>
            <argument name="code" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_ANYDAY</argument>
            <argument name="infoBlockType" xsi:type="string">QuickPayAnydayBlockInfo</argument>
            <argument name="validatorPool" xsi:type="object">QuickPayAnydayValidatorPool</argument>
            <argument name="valueHandlerPool" xsi:type="object">QuickPayAnydayValueHandlerPool</argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="QuickPayAnydayConfig" type="HW\QuickPay\Gateway\Config\General">
        <arguments>
            <argument name="methodCode" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_ANYDAY</argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayAnydayBlockInfo" type="HW\QuickPay\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayAnydayConfig</argument>
        </arguments>
    </virtualType>
    <!-- Validators infrastructure -->
    <virtualType name="QuickPayAnydayValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">QuickPayAnydayCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayAnydayCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayAnydayConfig</argument>
        </arguments>
    </virtualType>
    <!-- Value handlers infrastructure -->
    <virtualType name="QuickPayAnydayValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">QuickPayAnydayConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayAnydayConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">QuickPayAnydayConfig</argument>
        </arguments>
    </virtualType>
    <!-- End Anyday Method Facade configuration -->

    <!-- Start Trustly Method Facade configuration -->
    <virtualType name="QuickPayTrustlyFacade" type="QuickPayCreditCardFacade">
        <arguments>
            <argument name="code" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_TRUSTLY</argument>
            <argument name="infoBlockType" xsi:type="string">QuickPayTrustlyBlockInfo</argument>
            <argument name="validatorPool" xsi:type="object">QuickPayTrustlyValidatorPool</argument>
            <argument name="valueHandlerPool" xsi:type="object">QuickPayTrustlyValueHandlerPool</argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="QuickPayTrustlyConfig" type="HW\QuickPay\Gateway\Config\General">
        <arguments>
            <argument name="methodCode" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_TRUSTLY</argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayTrustlyBlockInfo" type="HW\QuickPay\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayTrustlyConfig</argument>
        </arguments>
    </virtualType>
    <!-- Validators infrastructure -->
    <virtualType name="QuickPayTrustlyValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">QuickPayTrustlyCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayTrustlyCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayTrustlyConfig</argument>
        </arguments>
    </virtualType>
    <!-- Value handlers infrastructure -->
    <virtualType name="QuickPayTrustlyValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">QuickPayTrustlyConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayTrustlyConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">QuickPayTrustlyConfig</argument>
        </arguments>
    </virtualType>
    <!-- End Trustly Method Facade configuration -->

    <!-- Start ViaBill Method Facade configuration -->
    <virtualType name="QuickPayViaBillFacade" type="QuickPayCreditCardFacade">
        <arguments>
            <argument name="code" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_VIABILL</argument>
            <argument name="infoBlockType" xsi:type="string">QuickPayViaBillBlockInfo</argument>
            <argument name="validatorPool" xsi:type="object">QuickPayViaBillValidatorPool</argument>
            <argument name="valueHandlerPool" xsi:type="object">QuickPayViaBillValueHandlerPool</argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="QuickPayViaBillConfig" type="HW\QuickPay\Gateway\Config\General">
        <arguments>
            <argument name="methodCode" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_VIABILL</argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayViaBillBlockInfo" type="HW\QuickPay\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayViaBillConfig</argument>
        </arguments>
    </virtualType>
    <!-- Validators infrastructure -->
    <virtualType name="QuickPayViaBillValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">QuickPayViaBillCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayViaBillCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayViaBillConfig</argument>
        </arguments>
    </virtualType>
    <!-- Value handlers infrastructure -->
    <virtualType name="QuickPayViaBillValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">QuickPayViaBillConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayViaBillConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">QuickPayViaBillConfig</argument>
        </arguments>
    </virtualType>
    <!-- End ViaBill Method Facade configuration -->

    <!-- Start Vipps Method Facade configuration -->
    <virtualType name="QuickPayVippsFacade" type="QuickPayCreditCardFacade">
        <arguments>
            <argument name="code" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_VIPPS</argument>
            <argument name="infoBlockType" xsi:type="string">QuickPayVippsBlockInfo</argument>
            <argument name="validatorPool" xsi:type="object">QuickPayVippsValidatorPool</argument>
            <argument name="valueHandlerPool" xsi:type="object">QuickPayVippsValueHandlerPool</argument>
        </arguments>
    </virtualType>
    <!-- Configuration reader -->
    <virtualType name="QuickPayVippsConfig" type="HW\QuickPay\Gateway\Config\General">
        <arguments>
            <argument name="methodCode" xsi:type="const">HW\QuickPay\Model\Ui\Checkout\ConfigProvider::CODE_VIPPS</argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayVippsBlockInfo" type="HW\QuickPay\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayVippsConfig</argument>
        </arguments>
    </virtualType>
    <!-- Validators infrastructure -->
    <virtualType name="QuickPayVippsValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">QuickPayVippsCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayVippsCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">QuickPayVippsConfig</argument>
        </arguments>
    </virtualType>
    <!-- Value handlers infrastructure -->
    <virtualType name="QuickPayVippsValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">QuickPayVippsConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="QuickPayVippsConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">QuickPayVippsConfig</argument>
        </arguments>
    </virtualType>
    <!-- End Vipps Method Facade configuration -->


    <!-- Commands infrastructure -->
    <virtualType name="QuickPayCreditCardCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="initialize" xsi:type="string">QuickPayCreditCardInitializeCommand</item>
                <item name="authorize" xsi:type="string">QuickPayCreditCardAuthorizeCommand</item>
                <item name="capture" xsi:type="string">QuickPayCreditCardCaptureCommand</item>
                <item name="sale" xsi:type="string">QuickPayCreditCardAutoCaptureCommand</item>
                <item name="refund" xsi:type="string">QuickPayCreditCardRefundCommand</item>
                <item name="cancel" xsi:type="string">QuickPayCreditCardCancelCommand</item>
                <item name="void" xsi:type="string">QuickPayCreditCardCancelCommand</item>
                <item name="fetch_transaction_information" xsi:type="string">QuickPayCreditCardFetchInfoCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="HW\QuickPay\Gateway\Request\AbstractRequest">
        <arguments>
            <argument name="logger" xsi:type="object">QuickPayLogger</argument>
        </arguments>
    </type>
    <type name="HW\QuickPay\Gateway\Http\Client\AbstractClient">
        <arguments>
            <argument name="logger" xsi:type="object">QuickPayLogger</argument>
        </arguments>
    </type>

    <!-- __________________ -->
    <!-- Initialize command -->
    <virtualType name="QuickPayCreditCardInitializeCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">QuickPayCreditCardInitializeRequestBuilderComposite</argument>
            <argument name="transferFactory" xsi:type="object">HW\QuickPay\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">HW\QuickPay\Gateway\Http\Client\Initialization</argument>
            <argument name="validator" xsi:type="object">QuickPayInitializeValidators</argument>
            <argument name="handler" xsi:type="object">QuickPayCreditCardInitializeResponseHandlerComposite</argument>
            <argument name="errorMessageMapper" xsi:type="object">HW\QuickPay\Gateway\ErrorMapper\ErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Initialization Request -->
    <virtualType name="QuickPayCreditCardInitializeRequestBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="store_id" xsi:type="string">HW\QuickPay\Gateway\Request\StoreId</item>
                <item name="payment" xsi:type="string">HW\QuickPay\Gateway\Request\Initialization</item>
                <item name="payment_link" xsi:type="string">HW\QuickPay\Gateway\Request\PaymentLink</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Initialization Validator -->
    <virtualType name="QuickPayInitializeValidators" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="errors" xsi:type="string">HW\QuickPay\Gateway\Validator\Response</item>
                <item name="initialize" xsi:type="string">HW\QuickPay\Gateway\Validator\InitializationValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Initialization Response handlers -->
    <virtualType name="QuickPayCreditCardInitializeResponseHandlerComposite" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="txnid" xsi:type="string">HW\QuickPay\Gateway\Response\GatewayTransId</item>
                <item name="payment_link" xsi:type="string">HW\QuickPay\Gateway\Response\PaymentLinkHandler</item>
                <item name="order_state" xsi:type="string">HW\QuickPay\Gateway\Response\Initialize\OrderState</item>
                <item name="mode_data" xsi:type="string">HW\QuickPay\Gateway\Response\ModeDataHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- _________________   -->
    <!-- Authorize command -->
    <virtualType name="QuickPayCreditCardAuthorizeCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">QuickPayCreditCardAuthorizeRequestBuilderComposite</argument>
            <argument name="transferFactory" xsi:type="object">HW\QuickPay\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">HW\QuickPay\Gateway\Http\Client\Get</argument>
            <argument name="validator" xsi:type="object">QuickPayAuthorizeValidators</argument>
            <argument name="handler" xsi:type="object">QuickPayCreditCardAuthorizeResponseHandlerComposite</argument>
            <argument name="errorMessageMapper" xsi:type="object">HW\QuickPay\Gateway\ErrorMapper\ErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Authorization Request -->
    <virtualType name="QuickPayCreditCardAuthorizeRequestBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="store_id" xsi:type="string">HW\QuickPay\Gateway\Request\StoreId</item>
                <item name="payment_id" xsi:type="string">HW\QuickPay\Gateway\Request\PaymentId</item>
                <item name="amount" xsi:type="string">HW\QuickPay\Gateway\Request\Amount</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Authorization Validator -->
    <virtualType name="QuickPayAuthorizeValidators" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="errors" xsi:type="string">HW\QuickPay\Gateway\Validator\Response</item>
                <item name="authorize" xsi:type="string">HW\QuickPay\Gateway\Validator\AuthorizeValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Authorization Response handlers -->
    <virtualType name="QuickPayCreditCardAuthorizeResponseHandlerComposite" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="mode_data" xsi:type="string">HW\QuickPay\Gateway\Response\ModeDataHandler</item>
                <item name="metadata" xsi:type="string">HW\QuickPay\Gateway\Response\MetaDataHandler</item>
<!--                /** Unfortunately we should avoid fraud suspect, because of "PSD2 - payments" rule */-->
<!--                <item name="fraud_data" xsi:type="string">HW\QuickPay\Gateway\Response\FraudHandler</item>-->
                <item name="transaction_data" xsi:type="string">HW\QuickPay\Gateway\Response\Authorize\TransactionAdditionalInfoHandler</item>
                <item name="test_data" xsi:type="string">HW\QuickPay\Gateway\Response\TestDataHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- _______________ -->
    <!-- Capture command -->
    <virtualType name="QuickPayCreditCardCaptureCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">QuickPayCreditCardCaptureRequestBuilderComposite</argument>
            <argument name="transferFactory" xsi:type="object">HW\QuickPay\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">HW\QuickPay\Gateway\Http\Client\Capture</argument>
            <argument name="validator" xsi:type="object">QuickPayCaptureValidators</argument>
            <argument name="handler" xsi:type="object">QuickPayCreditCardCaptureResponseHandlerComposite</argument>
            <argument name="errorMessageMapper" xsi:type="object">HW\QuickPay\Gateway\ErrorMapper\ErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!--Auto Capture command   -->
    <virtualType name="QuickPayCreditCardAutoCaptureCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">QuickPayCreditCardCaptureRequestBuilderComposite</argument>
            <argument name="transferFactory" xsi:type="object">HW\QuickPay\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">HW\QuickPay\Gateway\Http\Client\Get</argument>
            <argument name="validator" xsi:type="object">QuickPayCaptureValidators</argument>
            <argument name="handler" xsi:type="object">QuickPayCreditCardAutoCaptureResponseHandlerComposite</argument>
            <argument name="errorMessageMapper" xsi:type="object">HW\QuickPay\Gateway\ErrorMapper\ErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Capture Request -->
    <virtualType name="QuickPayCreditCardCaptureRequestBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="store_id" xsi:type="string">HW\QuickPay\Gateway\Request\StoreId</item>
                <item name="payment_id" xsi:type="string">HW\QuickPay\Gateway\Request\PaymentId</item>
                <item name="synchronized" xsi:type="string">HW\QuickPay\Gateway\Request\Synchronized</item>
                <item name="amount" xsi:type="string">HW\QuickPay\Gateway\Request\Amount</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Capture Validator -->
    <virtualType name="QuickPayCaptureValidators" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="errors" xsi:type="string">HW\QuickPay\Gateway\Validator\Response</item>
                <item name="capture" xsi:type="string">HW\QuickPay\Gateway\Validator\CaptureValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Capture Response handlers -->
    <virtualType name="QuickPayCreditCardCaptureResponseHandlerComposite" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="mode_data" xsi:type="string">HW\QuickPay\Gateway\Response\ModeDataHandler</item>
                <item name="metadata" xsi:type="string">HW\QuickPay\Gateway\Response\MetaDataHandler</item>
<!--                /** Unfortunately we should avoid fraud suspect, because of "PSD2 - payments" rule */-->
<!--                <item name="fraud_data" xsi:type="string">HW\QuickPay\Gateway\Response\FraudHandler</item>-->
                <item name="transaction_data" xsi:type="string">HW\QuickPay\Gateway\Response\Capture\TransactionAdditionalInfoHandler</item>
                <item name="test_data" xsi:type="string">HW\QuickPay\Gateway\Response\TestDataHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Autocapture Response handlers -->
    <virtualType name="QuickPayCreditCardAutoCaptureResponseHandlerComposite" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="mode_data" xsi:type="string">HW\QuickPay\Gateway\Response\ModeDataHandler</item>
                <item name="metadata" xsi:type="string">HW\QuickPay\Gateway\Response\MetaDataHandler</item>
<!--                /** Unfortunately we should avoid fraud suspect, because of "PSD2 - payments" rule */-->
<!--                <item name="fraud_data" xsi:type="string">HW\QuickPay\Gateway\Response\FraudHandler</item>-->
                <item name="transaction_data" xsi:type="string">HW\QuickPay\Gateway\Response\Capture\TransactionAdditionalInfoHandler</item>
                <item name="test_data" xsi:type="string">HW\QuickPay\Gateway\Response\TestDataHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- _______________-->
    <!-- Refund command -->
    <virtualType name="QuickPayCreditCardRefundCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">QuickPayCreditCardRefundRequestBuilderComposite</argument>
            <argument name="transferFactory" xsi:type="object">HW\QuickPay\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">HW\QuickPay\Gateway\Http\Client\Refund</argument>
            <argument name="validator" xsi:type="object">QuickPayRefundValidators</argument>
            <argument name="handler" xsi:type="object">QuickPayCreditCardRefundResponseHandlerComposite</argument>
            <argument name="errorMessageMapper" xsi:type="object">HW\QuickPay\Gateway\ErrorMapper\ErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Refund Request -->
    <virtualType name="QuickPayCreditCardRefundRequestBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="store_id" xsi:type="string">HW\QuickPay\Gateway\Request\StoreId</item>
                <item name="payment_id" xsi:type="string">HW\QuickPay\Gateway\Request\PaymentId</item>
                <item name="synchronized" xsi:type="string">HW\QuickPay\Gateway\Request\Synchronized</item>
                <item name="amount" xsi:type="string">HW\QuickPay\Gateway\Request\Amount</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Refund Validator -->
    <virtualType name="QuickPayRefundValidators" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="errors" xsi:type="string">HW\QuickPay\Gateway\Validator\Response</item>
                <item name="refund" xsi:type="string">HW\QuickPay\Gateway\Validator\RefundValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Refund Response handlers -->
    <virtualType name="QuickPayCreditCardRefundResponseHandlerComposite" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="mode_data" xsi:type="string">HW\QuickPay\Gateway\Response\ModeDataHandler</item>
                <item name="metadata" xsi:type="string">HW\QuickPay\Gateway\Response\MetaDataHandler</item>
                <item name="transaction_data" xsi:type="string">HW\QuickPay\Gateway\Response\Refund\TransactionAdditionalInfoHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- _______________-->
    <!-- Cancel command -->
    <virtualType name="QuickPayCreditCardCancelCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">QuickPayCreditCardCancelRequestBuilderComposite</argument>
            <argument name="transferFactory" xsi:type="object">HW\QuickPay\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">HW\QuickPay\Gateway\Http\Client\Cancel</argument>
            <argument name="validator" xsi:type="object">QuickPayCancelValidators</argument>
            <argument name="handler" xsi:type="object">QuickPayCreditCardCancelResponseHandlerComposite</argument>
            <argument name="errorMessageMapper" xsi:type="object">HW\QuickPay\Gateway\ErrorMapper\ErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Cancel Request -->
    <virtualType name="QuickPayCreditCardCancelRequestBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="store_id" xsi:type="string">HW\QuickPay\Gateway\Request\StoreId</item>
                <item name="payment_id" xsi:type="string">HW\QuickPay\Gateway\Request\PaymentId</item>
                <item name="synchronized" xsi:type="string">HW\QuickPay\Gateway\Request\Synchronized</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Cancel Validator -->
    <virtualType name="QuickPayCancelValidators" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="errors" xsi:type="string">HW\QuickPay\Gateway\Validator\Response</item>
                <item name="cancel" xsi:type="string">HW\QuickPay\Gateway\Validator\CancelValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Cancel Response handlers -->
    <virtualType name="QuickPayCreditCardCancelResponseHandlerComposite" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="mode_data" xsi:type="string">HW\QuickPay\Gateway\Response\ModeDataHandler</item>
                <item name="metadata" xsi:type="string">HW\QuickPay\Gateway\Response\MetaDataHandler</item>
                <item name="transaction_data" xsi:type="string">HW\QuickPay\Gateway\Response\Cancel\TransactionAdditionalInfoHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- ___________________-->
    <!-- Fetch info command -->
    <!-- Attention! We use our own gateway command and handler composite    -->
    <virtualType name="QuickPayCreditCardFetchInfoCommand" type="HW\QuickPay\Gateway\Command\FetchTransactionInformation">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">QuickPayCreditCardFetchInfoRequestBuilderComposite</argument>
            <argument name="transferFactory" xsi:type="object">HW\QuickPay\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">HW\QuickPay\Gateway\Http\Client\Get</argument>
            <argument name="validator" xsi:type="object">HW\QuickPay\Gateway\Validator\Response</argument>
            <argument name="handler" xsi:type="object">QuickPayCreditCardFetchInfoResponseHandlerComposite</argument>
            <argument name="errorMessageMapper" xsi:type="object">HW\QuickPay\Gateway\ErrorMapper\ErrorMessageMapper</argument>
        </arguments>
    </virtualType>
    <!-- Fetch info Request -->
    <virtualType name="QuickPayCreditCardFetchInfoRequestBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="store_id" xsi:type="string">HW\QuickPay\Gateway\Request\StoreId</item>
                <item name="payment_id" xsi:type="string">HW\QuickPay\Gateway\Request\PaymentId</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- Fetch info Response handlers -->
    <!-- Attention! We use our own handler composite    -->
    <virtualType name="QuickPayCreditCardFetchInfoResponseHandlerComposite" type="HW\QuickPay\Gateway\Response\HandlerChain\FetchTransactionInformation">
        <arguments>
            <argument name="handlers" xsi:type="array">
<!--                /** Unfortunately we should avoid fraud suspect, because of "PSD2 - payments" rule */ -->
<!--                <item name="fraud_data" xsi:type="string">HW\QuickPay\Gateway\Response\FraudHandler</item>-->

                <item name="transaction_data" xsi:type="string">HW\QuickPay\Gateway\Response\UpdateTransactionAdditionalInfoHandler</item>
                <item name="test_data" xsi:type="string">HW\QuickPay\Gateway\Response\TestDataHandler</item>
            </argument>
        </arguments>
    </virtualType>

</config>
